var entryDB=function(){var n=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,c={},d=null;return c.open=function(o){var e=n.open("lead",1);e.onupgradeneeded=function(e){var o=e.target.result;e.target.transaction.onerror=c.onerror,o.objectStoreNames.contains("lead")&&o.deleteObjectStore("lead");o.createObjectStore("lead",{keyPath:"timestamp"})},e.onsuccess=function(e){d=e.target.result,console.log("open success"),o()},e.onerror=c.onerror},c.fetchLeads=function(o){var e=d.transaction(["lead"],"readwrite"),n=e.objectStore("lead"),t=IDBKeyRange.lowerBound(0),r=n.openCursor(t),a=[];e.oncomplete=function(e){o(a)},r.onsuccess=function(e){var o=e.target.result;0!=!!o&&(a.push(o.value),o.continue())},r.onerror=c.onerror},c.createLead=function(e,o){if(d){var n=d.transaction(["lead"],"readwrite").objectStore("lead"),t=(new Date).getTime(),r={lead:e,timestamp:t=Math.round(t/1e3)},a=n.put(r);a.onsuccess=function(e){o(r)},a.onerror=c.onerror}else console.log("not there yet")},c.deleteLead=function(e,o){var n=d.transaction(["lead"],"readwrite").objectStore("lead").delete(e);n.onsuccess=function(e){o()},n.onerror=function(e){console.log(e)}},c}();